<!DOCTYPE html>
<html>

<!-- Proof of concept -->
<!-- references <API key from .env> should be replaced with the actual key (Atv...) in order
     for this to work -->

<head>
    <title>Bing Maps Demo</title>
    <meta charset="utf-8" />
    <style>
        /* * {
            padding: 1px;
            border-style: solid;
            border-color: red;
            border-width: 1;
        } */

        body {
            background-color: #abc6e1;
            margin: 50px;
        }

        #myMap {
            position: relative;
            width: 600px;
            height: 400px;
            margin: 50px;
            padding: 20px;
            border: 10px;
            border-style: solid;
            border-radius: 7px;
            border-width: 10px;
            border-color: #6d86ac
        }

        #bigdiv {
            background-color: #c9c9f9;
            flex-direction: column;
            margin: 30px;
        }

        button {
            padding: 10px;
            margin: 30px;
        }
    </style>
</head>

<body>

    <div id="bigdiv">
        <div id="myMap"></div>
        <div>
            <p>Latitude: <input type="text" id="lat" /></p>
            <p>Longitude: <input type="text" id="lon" /></p>
            <p>Zoom: <select name="zoom" id="zoom">
                <option>1</option>
                <option>2</option>
                <option>3</option>
                <option>4</option>
                <option>5</option>
                <option>6</option>
                <option>7</option>
                <option>8</option>
                <option>9</option>
                <option>10</option>
                <option>11</option>
                <option value="12">twelve</option>
                <option>13</option>
                <option>fourteen</option>
                <option>15</option>
                <option>16</option>
                <option>17</option>
                <option>18</option>
                <option>19</option>
                <option>20</option>
            </select></p>
            <p><button id="doitButton">This is a button</button></p>
        </div>
        <div>
            <h2>pin location</h2>
            <p>Pin Latitude: <input type="text" id="pinlat" /></p>
            <p>Pin Longitude: <input type="text" id="pinlon" /></p>
            <p><button id="setPinButton">Add Pin</button></p>
        </div>
    </div>

<!-- Per Dane, suggest the following two <script/> segments should be place directly in dashboard handlebars page
     (except that the API key in both would be rendered via object parameter (e.g. "{{api_key}}" or something like that) -->    

<script type='text/javascript'
    src='https://www.bing.com/api/maps/mapcontrol?callback=GetMap&key=<API key from .env>'
    async defer>
</script>

<script>
    let map = null;
    function GetMap() {
        map = new Microsoft.Maps.Map('#myMap', {
            // Note: API key here also, so also to be replaced with {{api_key}} or something to that effect
            credentials: '<API key from .env>',
            center: new Microsoft.Maps.Location(42.899319, -88.989220),  // TODO - SR ancestral home  (remove this comment)
            mapTypeId: Microsoft.Maps.MapTypeId.road,
            zoom: 15
        });

        //Add your post map load code here.

    }



</script>

<!-- Also per discussion with Dane, any other functions needed for centering the map, placing pins, etc. can go in helpers.js
     Not sure about the linkage between dashboard and helpers.js, but dashboard would call or reference these functions 
    
    Note that specific names of functions below are NOT what we will actually end up with in the integrated project.  These
    are just proof-of-concept.  Ultimately, actual function names will be settled on in helpers.js  So, DO NOT USE THESE! -->

<script type='text/javascript'>

    const theButton = document.querySelector("#doitButton");
    const pinButton = document.querySelector("#setPinButton");
    console.log('buttons set');

    setTimeout(doAfterTimeout, 5000);

    theButton.addEventListener("click", setMapFromLatLon);
    pinButton.addEventListener("click", setPin);

    console.log('listener activated');

    function doAfterTimeout() {
        map.setView({
            mapTypeId: Microsoft.Maps.MapTypeId.aerial,
            center: new Microsoft.Maps.Location(35.027222, -111.0225),
            zoom: 15
        });
    }

    function setMapFromLatLon() {
        console.log('button was pressed');
        console.log('setting new view from inputs');
        const lat = document.querySelector("#lat").value;
        const lon = document.querySelector("#lon").value;
        let zoomVar = document.querySelector("#zoom");
        let zoom = 12;
        if (zoomVar !== null) {
            zoom = zoomVar.value;
        }
        console.log('lat,loN=(',lat,',',lon,')');
        console.log('zoom = ', zoom)
        map.setView({
            mapTypeId: Microsoft.Maps.MapTypeId.road,
            center: new Microsoft.Maps.Location(lat, lon),
            zoom: parseInt(zoom)
        });
    }

    function setPin() {
        console.log('PIN button was pressed');
        const pinlat = document.querySelector("#pinlat").value;
        const pinlon = document.querySelector("#pinlon").value;
        console.log('pin lat,lon=(',lat,',',lon,')');
        const pinLoc = new Microsoft.Maps.Location(pinlat, pinlon);
        const pin = new Microsoft.Maps.Pushpin(
            pinLoc,
            {
                title: 'pin title',
                subTitle: 'pin subtitle',
                text: 'pin text'
            });
        map.entities.push(pin);
    }

</script>
</body>
</html>